<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Success</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/success.css">
</head>

<body>
  <!-- Top Header (shared style) -->
  <div class="top-container">
    <header class="header">
      <div class="header__logo">
        <a href="https://insightm.co.uk" title="Insights Media">
          <img src="https://insightm.co.uk/wp-content/themes/insights-media/images/logo.png" alt="Insights Media">
        </a>
      </div>
      <a href="#" class="header__hamburger" aria-label="Open Menu"></a>
    </header>
</div>

<main class="content-wrapper">
    <!-- Unified btn -->
<button class="btn-primary back-btn" onclick="history.back()">Back</button>

<div class="success-container">
    <img src="../image/success.png" alt="Success Icon" class="success-icon"> 
    <h2>All tasks completed successfully!</h2>
    <p>Would you like to receive a report on how your promotion performed?<br>
    Please leave your email below:</p>

    <div class="email-form">
      <input type="email" placeholder="Enter your email" id="report-email">
      <button class="btn-primary" id="submit-btn">Submit</button>
    </div>

    <button class="btn-primary start-btn" onclick="startNewUpload()">Start New Upload</button>
  </div>
</main>

<!-- js -->
<script type="module">
  import { downloadFile,submitEmailMock } from "../js/mockApi.js";

  // Automatic download trigger
  window.addEventListener("DOMContentLoaded", () => {
    downloadFile(true); // TODO:接後端-下載報告 PDF ，若是真實 API，請設為 false
  });

  // TODO:接後端-使用者點擊 Submit，送出 Email 到 API
document.querySelector(".email-form button").addEventListener("click", async () => {
  const email = document.querySelector("#report-email").value;

  if (!email || !email.includes("@")) {
    alert("請輸入有效的 Email");
    return;
  }

  // I use mockApi.js to test my code, if back-end okay , change api 
  try {
    const result = await submitEmailMock(email); // 用 mock 模擬提交
    if (result.status === "ok") {
      alert(" 模擬提交成功！Email 已收到：" + email);
    } else {
      throw new Error("Mock 模擬回傳錯誤");
    }
  } catch (err) {
    console.error("Mock 模擬提交失敗：", err);
    alert("送出失敗，請稍後再試！");
  }
});
</script>

<script>
    function goBack() {
      window.history.back();
    }
    function startNewUpload() {
      alert("Start a new upload (請連接到第一頁)");//請連接到第一頁
    }

  </script>
</body>
</html>